View(dataset)
load("C:/Users/mbofi/Dropbox/C5/Scripts/GitKraken/CBE_selection/results/results_SS.RData")
View(dataset)
View(dataset)
View(dataset)
dataset$samplesize_ce = mapply(samplesize_OR,p0=dataset$p0_ce, OR=dataset$OR_ce, alpha=alpha, beta=beta)
View(dataset)
dataset$ss_ratio = dataset$samplesize_e1/dataset$samplesize_ce
View(dataset)
save.image("C:/Users/mbofi/Dropbox/C5/Scripts/GitKraken/CBE_selection/results/results_SS.RData")
dataset$ss_decision = ifelse(dataset$ss_ratio<1, "RE", "CE")
dataset$ss_ratio = dataset$samplesize_e1/dataset$samplesize_ce
dataset$ss_decision = ifelse(dataset$ss_ratio<1, "RE", "CE")
save.image("C:/Users/mbofi/Dropbox/C5/Scripts/GitKraken/CBE_selection/results/results_SS.RData")
#
i=1
samplesize=dataset$samplesize_e1[i]/2;
i=1
samplesize=dataset$samplesize_e1[i]/2;
p0_e1=dataset$p0_e1[i];p1_e1=dataset$p1_e1[i];
OR1=dataset$OR1[i];
p0_e2=dataset$p0_e2[i];p1_e2=dataset$p1_e2[i];
OR2=dataset$OR2[i];
p0_ce=dataset$p0_ce[i];p1_ce=dataset$p1_ce[i]
total_ss = samplesize*2
# control group
sm0 = f_sim(samplesize=samplesize,p_e1=p0_e1,p_e2=p0_e2,p_ce=p0_ce)
# intervention group
sm1 = f_sim(samplesize=samplesize,p_e1=p1_e1,p_e2=p1_e2,p_ce=p1_ce)
# pooled sample
sm = sm0 + sm1
# estimated probabilities
phat0_e1 = (sm0[1]+sm0[2])/samplesize
phat0_e2 = (sm0[1]+sm0[3])/samplesize
phat0_ce = 1-(sm0[4])/samplesize
phat1_e1 = (sm1[1]+sm1[2])/samplesize
phat1_e2 = (sm1[1]+sm1[3])/samplesize
phat1_ce = 1-(sm1[4])/samplesize
# estimated correlation
corrhat0 = ((phat0_e1+phat0_e2-phat0_ce)-phat0_e1*phat0_e2)/sqrt(phat0_e1*(1-phat0_e1)*phat0_e2*(1-phat0_e2))
corrhat1 = ((phat1_e1+phat1_e2-phat1_ce)-phat1_e1*phat1_e2)/sqrt(phat1_e1*(1-phat1_e1)*phat1_e2*(1-phat1_e2))
corrhat = (corrhat0+corrhat1)/2
# correlation restrictions
update_uppcorr0=upper_corr(phat0_e1,phat0_e2)
update_uppcorr1=upper_corr(phat1_e1,phat1_e2)
uppcorr0=upper_corr(p0_e1,p0_e2)
uppcorr1=upper_corr(p1_e1,p1_e2)
uppcorr12=upper_corr((OR1*phat0_e1/(1-phat0_e1))/(1+(OR1*phat0_e1/(1-phat0_e1))),
(OR2*phat0_e2/(1-phat0_e2))/(1+(OR2*phat0_e2/(1-phat0_e2))))
library(CompARE)
source('C:/Users/mbofi/Dropbox/C5/Scripts/GitKraken/CBE_selection/Functions.R')
source('C:/Users/mbofi/Dropbox/C5/Scripts/GitKraken/CBE_selection/sim_functions_ce.R')
total_ss = samplesize*2
# control group
sm0 = f_sim(samplesize=samplesize,p_e1=p0_e1,p_e2=p0_e2,p_ce=p0_ce)
# intervention group
sm1 = f_sim(samplesize=samplesize,p_e1=p1_e1,p_e2=p1_e2,p_ce=p1_ce)
# pooled sample
sm = sm0 + sm1
# estimated probabilities
phat0_e1 = (sm0[1]+sm0[2])/samplesize
phat0_e2 = (sm0[1]+sm0[3])/samplesize
phat0_ce = 1-(sm0[4])/samplesize
phat1_e1 = (sm1[1]+sm1[2])/samplesize
phat1_e2 = (sm1[1]+sm1[3])/samplesize
phat1_ce = 1-(sm1[4])/samplesize
# estimated correlation
corrhat0 = ((phat0_e1+phat0_e2-phat0_ce)-phat0_e1*phat0_e2)/sqrt(phat0_e1*(1-phat0_e1)*phat0_e2*(1-phat0_e2))
corrhat1 = ((phat1_e1+phat1_e2-phat1_ce)-phat1_e1*phat1_e2)/sqrt(phat1_e1*(1-phat1_e1)*phat1_e2*(1-phat1_e2))
corrhat = (corrhat0+corrhat1)/2
# correlation restrictions
update_uppcorr0=upper_corr(phat0_e1,phat0_e2)
update_uppcorr1=upper_corr(phat1_e1,phat1_e2)
uppcorr0=upper_corr(p0_e1,p0_e2)
uppcorr1=upper_corr(p1_e1,p1_e2)
uppcorr12=upper_corr((OR1*phat0_e1/(1-phat0_e1))/(1+(OR1*phat0_e1/(1-phat0_e1))),
(OR2*phat0_e2/(1-phat0_e2))/(1+(OR2*phat0_e2/(1-phat0_e2))))
upp = min(update_uppcorr0,update_uppcorr1,uppcorr0,uppcorr1,uppcorr12)
update_lowcorr0= lower_corr(phat0_e1,phat0_e2)
update_lowcorr1=lower_corr(phat1_e1,phat1_e2)
lowcorr0= lower_corr(p0_e1,p0_e2)
lowcorr1=lower_corr(p1_e1,p1_e2)
lowcorr12=lower_corr((OR1*phat0_e1/(1-phat0_e1))/(1+(OR1*phat0_e1/(1-phat0_e1))),
(OR2*phat0_e2/(1-phat0_e2))/(1+(OR2*phat0_e2/(1-phat0_e2))))
low = max(update_lowcorr0,update_lowcorr1,lowcorr0,lowcorr1,lowcorr12)
corrhat_c = corrhat
if(corrhat > upp){
corrhat_c = upp
}
if(corrhat < low){
corrhat_c = low
}
samplesize_e1 = samplesize_OR(p0=phat0_e1, OR=OR1, alpha=0.05, beta=0.2)
samplesize_estar = samplesize_cbe(p0_e1=phat0_e1,p0_e2=phat0_e2,
eff_e1 = OR1,
effm_e1 = "or",
eff_e2 = OR2,
effm_e2 = "or",
effm_ce = "or",
rho=corrhat_c,
alpha = 0.05,
beta = 0.2)
ARE_up = samplesize_e1/samplesize_estar
ARE_up
dataset$ss_ratio[1]
dataset$corr[i]
corrhat_c
samplesize_cbe(p0_e1=phat0_e1,p0_e2=phat0_e2,
eff_e1 = OR1,
effm_e1 = "or",
eff_e2 = OR2,
effm_e2 = "or",
effm_ce = "or",
rho=corrhat_c,
alpha = 0.05,
beta = 0.2)
samplesize_cbe(p0_e1=phat0_e1,p0_e2=phat0_e2,
eff_e1 = OR1,
effm_e1 = "or",
eff_e2 = OR2,
effm_e2 = "or",
effm_ce = "or",
rho=0,
alpha = 0.05,
beta = 0.2)
dataset$samplesize_ce
dataset$samplesize_ce[1]
